
DROP TABLE IF EXISTS reports;
DROP TABLE IF EXISTS members;
DROP TABLE IF EXISTS stations;
DROP TABLE IF EXISTS lines;


CREATE TABLE lines (
  id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  name TEXT NOT NULL,
  color TEXT NOT NULL
);

CREATE TABLE members (
  id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  name TEXT NOT NULL,
  email TEXT NOT NULL,
  password TEXT,
  line INTEGER REFERENCES lines(id) ON DELETE CASCADE NOT NULL,
  unique (email)
);


CREATE TABLE stations (
  id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,  
  name TEXT NOT NULL,
  line INTEGER REFERENCES lines(id) ON DELETE CASCADE NOT NULL
);



CREATE TABLE reports (
  id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,  
  name TEXT NOT NULL, 
  date TIMESTAMPTZ NOT NULL,
  station INTEGER REFERENCES stations(id) ON DELETE CASCADE NOT NULL,
  strikes INTEGER DEFAULT 0
);
